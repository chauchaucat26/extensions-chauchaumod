Scratch.translate.setup({"ja":{"_Device":"デバイス","_getT":"[ip]の[thing]","_ip":"現在のIPアドレス","_country":"国","_country_name":"国名","_version":"バージョン","_city":"都市","_battery":"バッテリーの[thing]","_level":"残量","_dischargingTime":"残量残り時間","_chargingTime":"充電残り時間","_charging":"充電している"}});/* end generated l10n code */(function (Scratch) {
    "use strict";

    class Device {
      getInfo() {
        return {
          id: "device",
          name: Scratch.translate("Device"),
          color1: "#03cc00",
          color2: "#009900",
          menuIconURI: "data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMDguMjA1MzMiIGhlaWdodD0iMTU0LjU2MTI3IiB2aWV3Qm94PSIwLDAsMjA4LjIwNTMzLDE1NC41NjEyNyI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzNS44OTczMywtMTAyLjcxOTM3KSI+PGcgZGF0YS1wYXBlci1kYXRhPSJ7JnF1b3Q7aXNQYWludGluZ0xheWVyJnF1b3Q7OnRydWV9IiBmaWxsLXJ1bGU9Im5vbnplcm8iIHN0cm9rZS1saW5lam9pbj0ibWl0ZXIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLWRhc2hhcnJheT0iIiBzdHJva2UtZGFzaG9mZnNldD0iMCIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOiBub3JtYWwiPjxnPjxnIGZpbGw9IiNmZmZmZmYiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxNSIgc3Ryb2tlLWxpbmVjYXA9ImJ1dHQiPjxwYXRoIGQ9Ik0xNTIuNDA0MiwyNDkuNzgwNjRjLTQuOTc0MzgsMCAtOS4wMDY4NywtNC4wMzI0OSAtOS4wMDY4NywtOS4wMDY4N3YtOTAuMzk0NTRjMCwtNC45NzQzOCA0LjAzMjQ5LC05LjAwNjg2IDkuMDA2ODcsLTkuMDA2ODZoNDMuOTMzODZjNC45NzQzOCwwIDkuMDA2ODcsNC4wMzI0OSA5LjAwNjg3LDkuMDA2ODZ2OTAuMzk0NTRjMCw0Ljk3NDM4IC00LjAzMjQ5LDkuMDA2ODcgLTkuMDA2ODcsOS4wMDY4N3oiLz48cGF0aCBkPSJNMTY2LjgyODgxLDIyOC45NzcwOWMtNS43ODk4MywwIC0xMC40ODM0LC00LjY5MzU3IC0xMC40ODM0LC0xMC40ODM0di05Ny43OTA5MmMwLC01Ljc4OTgzIDQuNjkzNTcsLTEwLjQ4MzQgMTAuNDgzNCwtMTAuNDgzNGgxNTkuMjkwNDVjNS43ODk4MywwIDEwLjQ4MzQsNC42OTM1NyAxMC40ODM0LDEwLjQ4MzR2OTcuNzkwOTJjMCw1Ljc4OTgzIC00LjY5MzU3LDEwLjQ4MzQgLTEwLjQ4MzQsMTAuNDgzNHoiLz48L2c+PGcgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjIuNSI+PHBhdGggZD0iTTE1Ni4zNDU0NCwxMjguOTMyMDZ2LTguMjI5MjljMCwtNS43ODk4MyA0LjY5MzU3LC0xMC40ODM0IDEwLjQ4MzQsLTEwLjQ4MzRoMTU5LjI5MDQ1YzUuNzg5ODMsMCAxMC40ODM0LDQuNjkzNTcgMTAuNDgzNCwxMC40ODM0djk3Ljc5MDkyYzAsNS43ODk4MyAtNC42OTM1NywxMC40ODM0IC0xMC40ODM0LDEwLjQ4MzRoLTEwOC41ODc5NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTE1Mi40MDQyLDI0OS43ODA2N2MtNC45NzQzOCwwIC05LjAwNjg3LC00LjAzMjQ5IC05LjAwNjg3LC05LjAwNjg3di05MC4zOTQ1M2MwLC00Ljk3NDM4IDQuMDMyNDksLTkuMDA2ODcgOS4wMDY4NywtOS4wMDY4N2g0My45MzM4NmM0Ljk3NDM4LDAgOS4wMDY4Nyw0LjAzMjQ5IDkuMDA2ODcsOS4wMDY4N3Y5MC4zOTQ1M2MwLDQuOTc0MzggLTQuMDMyNDksOS4wMDY4NyAtOS4wMDY4Nyw5LjAwNjg3eiIgc3Ryb2tlLWxpbmVjYXA9ImJ1dHQiLz48cGF0aCBkPSJNMTg2LjgxMTM4LDIzNC43NzcwNGgtMjQuODgwNTIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjxwYXRoIGQ9Ik0yMTcuMTI4ODQsMjEzLjQ1MDg5aDcwLjM3NjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvZz48L2c+PC9nPjwvZz48L3N2Zz48IS0tcm90YXRpb25DZW50ZXI6MTA0LjEwMjY3NDk5OTk5OTk1Ojc3LjI4MDYyNTAwMDAwMDA2LS0+",
          blocks: [
            {
              opcode: "get",
              blockType: Scratch.BlockType.REPORTER,
              text: Scratch.translate("getT"),
              arguments: {
                ip: {
                  type: Scratch.ArgumentType.STRING,
                  defaultValue: "102.128.255.255",
                },
                thing: {
                  type: Scratch.ArgumentType.STRING,
                  menu: "gT",
                },
              },
            },
            {
              opcode: "ip",
              blockType: Scratch.BlockType.REPORTER,
              text: Scratch.translate("ip"),
            },
            {
              opcode: "battery",
              blockType: Scratch.BlockType.REPORTER,
              text: Scratch.translate("battery"),
              arguments: {
                thing: {
                  type: Scratch.ArgumentType.STRING,
                  menu: "gB",
                },
              },
            },
            {
              opcode: "charging",
              blockType: Scratch.BlockType.BOOLEAN,
              text: Scratch.translate("charging"),
            },
          ],
          menus: {
                gT: {
                    acceptReporters: false,
                    items: [
                      {
                        text: Scratch.translate("country"),
                        value: "country",
                      },
                      {
                        text: Scratch.translate("country_name"),
                        value: "country_name",
                      },
                      {
                        text: Scratch.translate("version"),
                        value: "version",
                      },
                      {
                        text: Scratch.translate("city"),
                        value: "city",
                      },
                    ],
                },
                gB: {
                    acceptReporters: false,
                    items: [
                      {
                        text: Scratch.translate("level"),
                        value: "level",
                      },
                      {
                        text: Scratch.translate("dischargingTime"),
                        value: "dischargingTime",
                      },
                      {
                        text: Scratch.translate("chargingTime"),
                        value: "chargingTime",
                      },
                    ],
                },
          },
        };
      }
  
      async get(args) {
        if (!await Scratch.canGeolocate()) return "";
        try {
        const response = await fetch("https://ipapi.co/" + args["ip"] + "/json/");
        const data = await response.json();
        const ip = args["thing"];
        return data[ip] ? data[ip] : "";
        } catch (error) { return "NaN" }
      }
      async ip() {
        if (!await Scratch.canGeolocate()) return "";
        try {
        const response = await fetch("https://ipinfo.io/?callback");
        const data = await response.json();
        return data.ip ? data.ip : "";
        } catch (error) { return "NaN" }
      }
      battery(args) {
        return navigator.getBattery()
        .then(battery => {
            const key = args["thing"];
            return battery[key];
        })
            .catch(error => {
            return null;
        });
      }
      charging(){
        return navigator.getBattery()
        .then(battery => {
            return battery.charging;
        })
            .catch(error => {
            return null;
        });
      } 
        
    }
  
    Scratch.extensions.register(new Device());
  })(Scratch);
